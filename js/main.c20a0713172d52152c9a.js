(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"2Qx2":function(e,t,o){"use strict";(function(e,n){o.d(t,"a",function(){return l});var i=o("W2Rx"),r=o("oj90");const a=o("33yf"),s=o("Iab2");var l={editingPath:e.observable(null),editingName:e.observable("NewFile"),editingType:e.observable("json"),editingFolder:e.observable(null),editingFileFolder:function(e=""){const t=l.editingPath()?l.editingPath():"";return e.length>0?a.join(a.dirname(t),e):a.dirname(t)},tryLoadConfigFile:function(){if(app.configFilePath=a.join(remote.app.getPath("home"),".yarn-story-editor.json"),fs.existsSync(app.configFilePath)&&(app.config=JSON.parse(fs.readFileSync(app.configFilePath)),console.log("Settings loaded from:\n"+app.configFilePath),app.config&&app.config.settings&&app.config.settings.autoSave)){if(app.config.settings.autoSave<.1)return;setInterval(function(){l.editingPath()&&(l.trySaveCurrent(),console.log("Autosaved:\n"+l.editingPath()))},6e4*app.config.settings.autoSave)}},readFile:function(e,t,o){var n=new FileReader;n.onload=function(i){var a=l.getFileType(t);a==r.a.UNKNOWN?alert("Unknown filetype!"):(l.editingPath(e.path),l.editingType(a),l.loadData(n.result,a,o))},n.readAsText(e)},openFile:function(e,t){l.editingPath()&&!confirm("Are you sure you want to close \n"+l.editingPath()+"\nAny unsaved progress will be lost...")||(l.editingName(t.replace(/^.*[\\\/]/,"")),document.title=e.path?e.path:l.editingName(),l.readFile(e,t,!0),app.refreshWindowTitle(t))},openFolder:function(e,t){editingFolder=t,alert("openFolder not yet implemented e: "+e+" foldername: "+t)},appendFile:function(e,t){l.readFile(e,t,!1)},getFileType:function(e){return e.toLowerCase().indexOf(".json")>-1?r.a.JSON:e.toLowerCase().indexOf(".yarn.txt")>-1?r.a.YARNTEXT:e.toLowerCase().indexOf(".yarn")>-1?r.a.YARNTEXT:e.toLowerCase().indexOf(".xml")>-1?r.a.XML:e.toLowerCase().indexOf(".txt")>-1?r.a.TWEE:e.toLowerCase().indexOf(".tw2")>-1?r.a.TWEE2:e.toLowerCase().indexOf(".twee")>-1?r.a.TWEE2:r.a.UNKNOWN},loadData:function(e,t,o){o&&app.nodes.removeAll();var a=[],s=0;if(t==r.a.JSON){if(!(e=JSON.parse(e)))return;for(s=0;s<e.length;s++)a.push(e[s])}else if(t==r.a.YARNTEXT){var c=e.split(/\r?\n/),d=null,u=0,p=!1;for(s=0;s<c.length;s++)if("==="==c[s].trim())p=!1,null!=d&&(a.push(d),d=null);else if(p)d.body+=c[s]+"\n";else if(c[s].indexOf("title:")>-1)null==d&&(d={}),d.title=c[s].substr(7,c[s].length-7);else if(c[s].indexOf("position:")>-1){null==d&&(d={});var g=c[s].substr(9,c[s].length-9).split(",");d.position={x:Number(g[0].trim()),y:Number(g[1].trim())}}else c[s].indexOf("colorID:")>-1?(null==d&&(d={}),d.colorID=Number(c[s].substr(9,c[s].length-9).trim())):c[s].indexOf("tags:")>-1?(null==d&&(d={}),d.tags=c[s].substr(6,c[s].length-6)):"---"==c[s].trim()&&(p=!0,d.body="");null!=d&&a.push(d)}else if(t==r.a.TWEE||t==r.a.TWEE2){for(c=e.split("\n"),d=null,u=0,s=0;s<c.length;s++)if(c[s]=c[s].trim(),"::"==c[s].substr(0,2)){null!=d&&a.push(d),d={};var h="",f="",m={x:80*++u,y:80*u},y=c[s].indexOf("["),v=c[s].indexOf("]");y>0&&v>0&&(f=c[s].substr(y+1,v-y-1));var b=c[s].indexOf("<"),x=c[s].indexOf(">");if(b>0&&x>0){var w=c[s].substr(b+1,x-b-1).split(",");m.x=parseInt(w[0]),m.y=parseInt(w[1])}var T=0;y>0?T=y:b>0&&(T=b),h=(h=T?c[s].substr(3,T-3):c[s].substr(3)).trim(),d.title=h,d.tags=f,d.body="",d.position=m}else null!=d&&(d.body.length>0&&(c[s]+="\n"),d.body+=c[s]);null!=d&&a.push(d)}else if(t==r.a.XML){var k=(new DOMParser).parseFromString(e,"text/xml");if(null!=(e=r.b.xmlToObject(k)))for(s=0;s<e.length;s++)a.push(e[s])}var S=0,C=0,N=0;for(s=0;s<a.length;s++){var E=new i.a;app.nodes.push(E);var I=a[s];null!=I.title&&E.title(I.title),null!=I.body&&E.body(I.body),null!=I.tags&&E.tags(I.tags),null!=I.position&&null!=I.position.x&&(E.x(parseInt(I.position.x)),S+=parseInt(I.position.x),N++),null!=I.position&&null!=I.position.y&&(E.y(parseInt(I.position.y)),C+=parseInt(I.position.y)),null!=I.colorID&&E.colorID(I.colorID)}N>0&&app.warpToNodeXY(S/N,C/N),n(".arrows").css({opacity:0}).transition({opacity:1},500),app.updateNodeLinks();var O=new CustomEvent("yarnLoadedData");O.document=document,O.data=l,O.app=app,window.parent.dispatchEvent(O)},getSaveData:function(e){for(var t="",o=[],n=app.nodes(),i=0;i<n.length;i++)o.push({title:n[i].title(),tags:n[i].tags(),body:n[i].body(),position:{x:n[i].x(),y:n[i].y()},colorID:n[i].colorID()});if(e==r.a.JSON)t=JSON.stringify(o,null,"\t");else if(e==r.a.YARNTEXT)for(i=0;i<o.length;i++){t+="title: "+o[i].title+"\n",t+="tags: "+o[i].tags+"\n",t+="colorID: "+o[i].colorID+"\n",t+="position: "+o[i].position.x+","+o[i].position.y+"\n",t+="---\n",t+=o[i].body;var a=o[i].body;a.length>0&&"\n"==a[a.length-1]||(t+="\n"),t+="===\n"}else if(e==r.a.TWEE)for(i=0;i<o.length;i++){var s="";o[i].tags.length>0&&(s=" ["+o[i].tags+"]"),t+=":: "+o[i].title+s+"\n",t+=o[i].body+"\n\n"}else if(e==r.a.TWEE2)for(i=0;i<o.length;i++){s="";o[i].tags.length>0&&(s=" ["+o[i].tags+"]");var l=" <"+o[i].position.x+","+o[i].position.y+">";t+=":: "+o[i].title+s+l+"\n",t+=o[i].body+"\n\n"}else if(e==r.a.XML){for(t+="<nodes>\n",i=0;i<o.length;i++)t+="\t<node>\n",t+="\t\t<title>"+o[i].title+"</title>\n",t+="\t\t<tags>"+o[i].tags+"</tags>\n",t+="\t\t<body>"+o[i].body+"</body>\n",t+='\t\t<position x="'+o[i].position.x+'" y="'+o[i].position.y+'"></position>\n',t+="\t\t<colorID>"+o[i].colorID+"</colorID>\n",t+="\t</node>\n";t+="</nodes>\n"}return t},saveTo:function(e,t,o=null){null!=app.fs&&app.fs.writeFile(e,t,{encoding:"utf-8"},function(t){l.editingPath(e),o&&o(),t&&alert("Error Saving Data to "+e+": "+t)})},openFileDialog:function(e,t){e.bind("change",function(o){t(o.currentTarget.files[0],e.val());var n="";null!=e.attr("nwsaveas")&&(n='nwsaveas="'+e.attr("nwsaveas")+'"'),null!=e.attr("accept")&&(n='accept="'+e.attr("accept")+'"'),e.parent().append('<input type="file" id="'+e.attr("id")+'"  '+n+">"),e.unbind("change"),e.remove()}),e.trigger("click")},saveFileDialog:function(e,t,o){var n=new Blob([o],{type:"text/plain;charset=utf-8"});s(n,l.editingName().replace(/\.[^\/.]+$/,"")+"."+t)},insertImageFileName:function(){l.openFileDialog(n("#open-image"),function(e,t){app.insertTextAtCursor(e.path?e.path:e.name)})},tryOpenFile:function(){l.openFileDialog(n("#open-file"),l.openFile)},tryLoadFromDropbox:function(e){console.log("fetched from db",e),n.get(e.link,function(t){var o=l.getFileType(e.name);o==r.a.UNKNOWN?alert("Unknown filetype!"):(l.editingPath(e.link),l.editingType(o),l.loadData(t,o,!0))})},trySaveDropbox:function(){console.log("Saving db",Dropbox.save);const e=l.editingType(),t=l.editingName().replace(/\.[^\/.]+$/,"")+"."+e,o=l.getSaveData(e);console.log(e,o,t),app.yarnTextFileUrl=null;var n={files:[{url:r.b.makeTextFile(o,app.yarnTextFileUrl),filename:l.editingName().replace(/\.[^\/.]+$/,"")+"."+t}],success:function(){alert("Success! Files saved to your Dropbox.")},progress:function(e){},cancel:function(){},error:function(e){}};Dropbox.save(n)},tryOpenFolder:function(){l.openFileDialog(n("#open-folder"),l.openFolder)},tryAppend:function(){l.openFileDialog(n("#open-file"),l.appendFile)},trySave:function(e){l.editingType(e),l.saveFileDialog(n("#save-file"),e,l.getSaveData(e))},trySaveCurrent:function(){l.editingPath().length>0&&l.editingType().length>0&&l.saveTo(l.editingPath(),l.getSaveData(l.editingType()))},doesFileExist:function(e){return!1}}}).call(this,o("Z1dp"),o("EVdn"))},P0sH:function(e,t,o){"use strict";(function(e,n){o.d(t,"a",function(){return l});var i=o("owJe"),r=o("W2Rx"),a=o("2Qx2"),s=o("oj90"),l=function(t,l){var c=this;this.instance=this,this.data=a.a,this.name=e.observable(t),this.version=e.observable(l),this.editing=e.observable(null),this.deleting=e.observable(null),this.nodes=e.observableArray([]),this.cachedScale=1,this.canvas,this.context,this.nodeHistory=[],this.nodeFuture=[],this.editingHistory=[],this.editingSaveHistoryTimeout=null,this.dirty=!1,this.focusedNodeIdx=-1,this.zoomSpeed=.005,this.zoomLimitMin=.05,this.zoomLimitMax=1,this.transformOrigin=[0,0],this.shifted=!1,this.isElectron=!1,this.editor=null,this.nodeVisitHistory=[],this.mouseX=0,this.mouseY=0,this.clipboard="",this.nodeClipboard=[],this.speachInstance=null,this.selectedLanguageIndex=6,this.language=null,this.hasTouchScreen=!1,this.UPDATE_ARROWS_THROTTLE_MS=25,this.configFilePath=null,this.config={nightModeEnabled:!1,spellcheckEnabled:!0,transcribeEnabled:!1,showCounter:!1,autocompleteWordsEnabled:!0,autocompleteEnabled:!0,overwrites:{makeNewNodesFromLinks:!0},settings:{autoSave:-1}},this.editingPath=e.observable(null),this.nodeSelection=[],this.$searchField=n(".search-field"),this.run=function(){var t="Unknown OS";-1!=navigator.platform.indexOf("Win")&&(t="Windows"),-1!=navigator.platform.indexOf("Mac")&&(t="MacOS"),-1!=navigator.platform.indexOf("X11")&&(t="UNIX"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),-1!=navigator.platform.indexOf("Linux")&&(t="Linux"),c.isElectron=navigator.userAgent.toLowerCase().includes("electron"),window.addEventListener("touchstart",function(){c.hasTouchScreen=!0});var o,r,l,d,u,p,g,h=navigator.userAgent||navigator.vendor||window.opera;/android|iPad|iPhone|iPod/.test(h.toLowerCase())&&!window.MSStream&&(t="mobile"),"Windows"==t&&(c.zoomSpeed=.1),n("#app").show(),e.applyBindings(c,n("#app")[0]),c.canvas=n(".arrows")[0],c.context=c.canvas.getContext("2d"),c.newNode().title("Start"),c.$searchField.on("keyup",function(e){c.searchWarp(),27==e.keyCode&&c.clearSearch()}),"mobile"===t&&c.zoom(3),s.b.createDropboxChooser(document.getElementById("dropbox-container"),e=>a.a.tryLoadFromDropbox(e)),e.bindingHandlers.preventBubble={init:function(t,o){var n=e.utils.unwrapObservable(o());e.utils.registerEventHandler(t,n,function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()})}},e.bindingHandlers.mousedown={init:function(t,o,i,r,a){var s=e.unwrap(o());n(t).mousedown(function(){s()})}},o=!1,r={x:0,y:0},l=!1,d=[],u={x1:0,y1:0,x2:0,y2:0},p=[0,0],g=!1,n(".nodes").on("pointerdown",function(e){1==e.button&&(g=!0),n("#marquee").css({x:0,y:0,width:0,height:0}),o=!0,r.x=e.pageX,r.y=e.pageY,d=[],u={x1:0,y1:0,x2:0,y2:0},c.cachedScale,p[0]=0,p[1]=0,e.altKey||e.shiftKey||c.deselectAllNodes()}),n(".nodes").on("mousemove touchmove",function(e){if(o){const o=c.hasTouchScreen&&e.changedTouches?e.changedTouches[0].pageX:e.pageX,f=c.hasTouchScreen&&e.changedTouches?e.changedTouches[0].pageY:e.pageY;if(e.altKey||g||c.hasTouchScreen)if(l)d=[],u={x1:0,y1:0,x2:0,y2:0},n("#marquee").css({x:0,y:0,width:0,height:0});else{var t=c.nodes();for(var i in t)t[i].x(t[i].x()+(o-r.x)/c.cachedScale),t[i].y(t[i].y()+(f-r.y)/c.cachedScale);r.x=o,r.y=f}else{l=!0;var a=c.cachedScale;for(var i in o>r.x&&f<r.y?(u.x1=r.x,u.y1=f,u.x2=o,u.y2=r.y):o>r.x&&f>r.y?(u.x1=r.x,u.y1=r.y,u.x2=o,u.y2=f):o<r.x&&f<r.y?(u.x1=o,u.y1=f,u.x2=r.x,u.y2=r.y):(u.x1=o,u.y1=r.y,u.x2=r.x,u.y2=f),n("#marquee").css({x:u.x1,y:u.y1,width:Math.abs(u.x1-u.x2),height:Math.abs(u.y1-u.y2)}),t=c.nodes()){var s=d.indexOf(t[i]),p=s>=0,h=n(".nodes-holder").offset();(u.x2-h.left)/a>t[i].x()&&(u.x1-h.left)/a<t[i].x()+t[i].tempWidth&&(u.y2-h.top)/a>t[i].y()&&(u.y1-h.top)/a<t[i].y()+t[i].tempHeight?p||(c.addNodeSelected(t[i]),d.push(t[i])):p&&(c.removeNodeSelection(t[i]),d.splice(s,1))}}}}),n(".nodes").on("pointerup",function(e){1==e.button&&(g=!1),o=!1,l&&0==d.length&&c.deselectAllNodes(),d=[],u={x1:0,y1:0,x2:0,y2:0},n("#marquee").css({x:0,y:0,width:0,height:0}),l=!1}),c.$searchField.on("input",c.updateSearch),n(".search-title input").click(c.updateSearch),n(".search-body input").click(c.updateSearch),n(".search-tags input").click(c.updateSearch),n(".nodes").mousewheel(function(e){if(!e.altKey){e.preventDefault();var t=c.cachedScale,o=e.deltaY*c.zoomSpeed*c.cachedScale;c.cachedScale+o>c.zoomLimitMax?c.cachedScale=c.zoomLimitMax:c.cachedScale+o<c.zoomLimitMin?c.cachedScale=c.zoomLimitMin:c.cachedScale+=o;var n=e.pageX-c.transformOrigin[0],i=e.pageY-c.transformOrigin[1],r=n-n*(c.cachedScale/t),a=i-i*(c.cachedScale/t);c.transformOrigin[0]+=r,c.transformOrigin[1]+=a,c.translate()}}),n(document).on("keyup keydown",function(e){c.shifted=e.shiftKey}),n(document).contextmenu(function(e){var t=n(e.target).hasClass("nodes")||n(e.target).parents(".nodes").length;if(2==e.button&&t){var o=-1*c.transformOrigin[0]/c.cachedScale,i=-1*c.transformOrigin[1]/c.cachedScale;o+=f.pageX/c.cachedScale,i+=f.pageY/c.cachedScale,c.newNodeAt(o,i)}return!t}),n(document).on("keydown",function(e){if((e.metaKey||e.ctrlKey)&&!c.editing())switch(e.keyCode){case 90:c.historyDirection("undo");break;case 89:c.historyDirection("redo");break;case 68:c.deselectAllNodes()}}),n(document).on("keydown",function(e){if(e.ctrlKey||e.metaKey)if(e.shiftKey)switch(e.keyCode){case 83:a.a.trySave(s.a.JSON),c.fileKeyPressed=!0;break;case 65:a.a.tryAppend(),c.fileKeyPressed=!0}else if(e.altKey)switch(e.keyCode){case 83:a.a.trySave(s.a.YARNTEXT),c.fileKeyPressed=!0}else switch(e.keyCode){case 83:null!=a.a.editingPath()?a.a.trySaveCurrent():a.a.trySave(s.a.JSON),c.fileKeyPressed=!0;break;case 79:a.a.tryOpenFile(),c.fileKeyPressed=!0}}),n(document).on("keydown",function(e){c.editing()?(e.metaKey||e.ctrlKey)&&67==e.keyCode?c.clipboard=c.editor.getSelectedText():(e.metaKey||e.ctrlKey)&&88==e.keyCode&&(app.clipboard=app.editor.getSelectedText(),app.insertTextAtCursor("")):(e.metaKey||e.ctrlKey)&&67==e.keyCode?c.nodeClipboard=app.cloneNodeArray(c.getSelectedNodes()):(e.metaKey||e.ctrlKey)&&88==e.keyCode&&(c.nodeClipboard=app.cloneNodeArray(c.getSelectedNodes()),c.deleteSelectedNodes())}),n(document).on("keydown",function(e){if(!(c.editing()||c.$searchField.is(":focus")||e.ctrlKey||e.metaKey)){var t=c.cachedScale||1,o=500*t;e.shiftKey&&(o=100*t),65===e.keyCode||37===e.keyCode?c.transformOrigin[0]+=o:68===e.keyCode||39===e.keyCode?c.transformOrigin[0]-=o:87===e.keyCode||38===e.keyCode?c.transformOrigin[1]+=o:83!==e.keyCode&&40!==e.keyCode||(c.transformOrigin[1]-=o),c.translate(100)}}),n(document).on("keyup",function(e){if((e.metaKey||e.ctrlKey)&&86==e.keyCode&&!c.editing()&&c.nodeClipboard.length&&(c.deselectAllNodes(),c.nodeClipboard.forEach(function(e){c.nodes.push(e),c.addNodeSelected(e),c.recordNodeAction("created",e)}),c.updateNodeLinks()),46!==e.keyCode&&"Delete"!==e.key||null===c.editing()&&c.deleteSelectedNodes(),31===e.keyCode||"Enter"===e.key)if(null===c.editing()){var t=c.nodes()[c.focusedNodeIdx];void 0!==t?c.editNode(t):c.editNode(c.nodes()[0])}else e.ctrlKey&&e.altKey&&c.saveNode();if(32===e.keyCode){if(null!==c.editing()&&!e.altKey)return;var o=c.getSelectedNodes(),i=o.length>0?o:c.nodes(),r=o.length>0;c.focusedNodeIdx>-1&&i.length>c.focusedNodeIdx&&(c.transformOrigin[0]!=-i[c.focusedNodeIdx].x()+n(window).width()/2-n(i[c.focusedNodeIdx].element).width()/2||c.transformOrigin[1]!=-i[c.focusedNodeIdx].y()+n(window).height()/2-n(i[c.focusedNodeIdx].element).height()/2)&&(c.focusedNodeIdx=-1),++c.focusedNodeIdx>=i.length&&(c.focusedNodeIdx=0),c.cachedScale=1,r?c.warpToSelectedNodeIdx(c.focusedNodeIdx):c.warpToNodeIdx(c.focusedNodeIdx),null!==c.editing()&&c.editNode(c.nodes()[c.focusedNodeIdx])}}),n(window).on("resize",c.updateArrowsThrottled),n(document).on("keyup keydown pointerdown pointerup",function(e){null!=c.editing()&&c.updateEditorStats()}),this.guessPopUpHelper=function(){c.getTagBeforeCursor().match(/\[color=#/)?c.insertColorCode():c.getTagBeforeCursor().match(/\[img\]/)},this.insertBBcodeTags=function(e){var t="[/"+e.replace(/[\"#=]/gi,"")+"]";"cmd"===e?(e="<<",t=">>"):"opt"===e?(e="[[",t="|]]"):e="["+e+"]";var o=JSON.parse(JSON.stringify(c.editor.selection.getRange()));if(c.editor.session.insert(o.start,e),c.editor.session.insert({column:o.end.column+e.length,row:o.end.row},t),"[color=#]"===e){if(0===c.editor.getSelectedText().length)return c.moveEditCursor(-9),void c.insertColorCode();c.editor.selection.setRange({start:{row:c.editor.selection.getRange().start.row,column:c.editor.selection.getRange().start.column-1},end:{row:c.editor.selection.getRange().start.row,column:c.editor.selection.getRange().start.column-1}}),c.insertColorCode()}else 0===c.editor.getSelectedText().length?c.moveEditCursor(-t.length):c.editor.selection.setRange({start:c.editor.selection.getRange().start,end:{row:c.editor.selection.getRange().end.row,column:c.editor.selection.getRange().end.column-t.length}});c.editor.focus()},this.insertEmoji=function(){this.emPicker.toggle(),c.togglePreviewMode(!0),n("#emojiPicker-container").css({top:c.mouseY-125,left:c.mouseX-200}),n("#emojiPicker-container").show()},this.updateCountry=function(){var e=document.getElementById("select_language");c.selectedLanguageIndex=e.selectedIndex,c.language=s.b.langs[e.selectedIndex][1][0],spoken.recognition.lang=c.language,Object(i.load_dictionary)(c.language.split("-")[0])},this.speakText=function(){const e=c.editor.getSelectedText(),t=e||c.editor.getSession().getValue();spoken.voices().then(e=>{const o=c.language.split("-")[0],n=e.filter(e=>!e.lang.indexOf(o));n.length?(console.log("Loaded voice",n[0]),spoken.say(t,n[0])):spoken.say(t)})},this.startCapture=function(){spoken.listen({continuous:!0}).then(e=>{if(console.log(e),c.editing())c.insertTextAtCursor(e+". "),document.getElementById("speakTextBtnBubble").title="Transcribe";else if("open"===e){console.log("try open...");var t=c.getFirstFoundNode(c.$searchField.val().toLowerCase()).title();console.log("try open:",t),c.openNodeByTitle(t)}else"clear"===e?(c.$searchField.val(""),c.updateSearch()):(c.$searchField.val(e),c.updateSearch());spoken.listen.stop().then(()=>{c.editing()&&(document.getElementById("speakTextBtnBubble").style.visibility="hidden"),this.continueCapture()})}).catch(e=>spoken.listen.stop().then(()=>this.continueCapture()))},this.continueCapture=function(){spoken.delay(500).then(()=>{spoken.recognition.continuous&&c.startCapture()})},this.toglTranscribing=function(){const e=spoken.listen.available();var t=document.getElementById("toglTranscribing"),o=document.getElementById("speakTextBtnBubble");c.config.transcribeEnabled=t.checked,t.checked&&e?(spoken.listen.on.partial(e=>{c.editing()?(o.style.visibility="visible",o.title=`🗣️ ${e} 🦜`):c.$searchField.val(`🗣️ ${e} 🦜`)}),c.startCapture()):(o.style.visibility="hidden",t.checked=!1,spoken.recognition.continuous=!1,spoken.listen.stop())},this.hearText=function(){spoken.listen.available()?(spoken.listen.on.partial(e=>{console.log(e),document.getElementById("speakTextBtnBubble").title=`🗣️ ${e} 🦜`}),spoken.listen().then(e=>{c.insertTextAtCursor(e+" "),document.getElementById("speakTextBtnBubble").title="Transcribe"}).catch(e=>console.warn(e.message))):alert("Speech recognition not avaiilable!")},n(document).on("pointermove",function(e){c.mouseX=e.pageX,c.mouseY=e.pageY}),this.insertColorCode=function(){n("#colorPicker-container").is(":visible")||(n("#colorPicker").spectrum("set",c.editor.getSelectedText()),n("#colorPicker").spectrum("toggle"),n("#colorPicker-container").css({top:c.mouseY-50,left:c.mouseX-70}),n("#colorPicker-container").show(),n("#colorPicker").on("dragstop.spectrum",function(e,t){c.applyPickerColorEditor(t)}),c.togglePreviewMode(!0))},this.applyPickerColorEditor=function(e){var t=JSON.parse(JSON.stringify(c.editor.selection.getRange()));c.editor.selection.setRange(t);var o=e.toHexString().replace("#","");c.editor.session.replace(t,o),c.editor.selection.setRange({start:c.editor.getCursorPosition(),end:{row:c.editor.getCursorPosition().row,column:c.editor.getCursorPosition().column-o.length}}),c.togglePreviewMode(!0)},document.addEventListener("contextmenu",function(e){c.editing()&&e.preventDefault()},!1),n(document).on("pointerup",function(e){c.editing()&&2===e.button&&c.guessPopUpHelper()}),document.ondragover=document.ondrop=e=>{e.preventDefault()},document.body.ondrop=e=>{var t;for(e.preventDefault(),t=0;t<e.dataTransfer.files.length;t++)a.a.appendFile(e.dataTransfer.files[t],e.dataTransfer.files[t].name,!1)};var f=new CustomEvent("yarnReady");f.document=document,f.data=a.a,f.app=this,window.parent.dispatchEvent(f)},this.getNodesConnectedTo=function(e){var t=[],o=c.nodes();for(var n in o)if(o[n]!=e&&o[n].isConnectedTo(e,!0)){var i=!1;for(var r in t)if(t[r]==o[n]){i=!0;break}i||t.push(o[n])}return t},this.mouseUpOnNodeNotMoved=function(){c.deselectAllNodes()},this.matchConnectedColorID=function(e){var t=c.getNodesConnectedTo(e);for(var o in t)t[o].colorID(e.colorID())},this.quit=function(){c.isElectron},this.validateTitle=function(){var e=document.getElementById("editorTitle").value;c.getOtherNodeTitles().includes(e)||c.titleExistsTwice(e)?(n("#editorTitle").css({color:"red"}),n("#editorTitle").attr("title","Another node has the same title")):(n("#editorTitle").css({color:"#666"}),n("#editorTitle").attr("title",""))},this.refreshWindowTitle=function(e){let t="Yarn - ["+e+"] ";c.isElectron||(document.title=t)},this.recordNodeAction=function(e,t){if(c.nodeFuture.length>0){for(var o=0;o<c.nodeFuture.length;o++){delete c.nodeFuture.pop().node}delete c.nodeFuture,c.nodeFuture=[]}var n={action:e,node:t,lastX:t.x(),lastY:t.y()};"removed"==e&&(n.lastY+=80),c.nodeHistory.push(n)},this.historyDirection=function(e){function t(e){var t=c.nodes.indexOf(e);t>=0&&c.nodes.splice(t,1),c.updateNodeLinks()}var o=null;if(o="undo"==e?c.nodeHistory.pop():c.nodeFuture.pop()){var n=o.action,i=o.node;"undo"==e?("created"==n?(o.lastX=i.x(),o.lastY=i.y(),t(i)):"removed"==n&&c.recreateNode(i,o.lastX,o.lastY),c.nodeFuture.push(o)):("created"==n?c.recreateNode(i,o.lastX,o.lastY):"removed"==n&&t(i),c.nodeHistory.push(o))}},this.recreateNode=function(e,t,o){c.nodes.push(e),e.moveTo(t,o),c.updateNodeLinks()},this.setSelectedColors=function(e){var t=c.getSelectedNodes();for(var o in t.splice(t.indexOf(e),1),t)t[o].colorID(e.colorID())},this.getSelectedNodes=function(){var e=[];for(var t in c.nodeSelection)e.push(c.nodeSelection[t]);return e},this.deselectAllNodes=function(){var e=c.nodes();for(var t in e)c.removeNodeSelection(e[t])},this.addNodeSelected=function(e){c.nodeSelection.indexOf(e)<0&&(c.nodeSelection.push(e),e.setSelected(!0))},this.removeNodeSelection=function(e){var t=c.nodeSelection.indexOf(e);t>=0&&(c.nodeSelection.splice(t,1),e.setSelected(!1))},this.deleteSelectedNodes=function(){var e=c.getSelectedNodes();for(var t in e)c.removeNodeSelection(e[t]),e[t].remove()},this.cloneNodeArray=function(e){return e.map(function(e){var t=new r.a;return t.title(e.title()),t.body(e.body()),t.tags(e.tags()),t.colorID(e.colorID()),t.createX=e.x()+10,t.createY=e.y()+10,t})},this.newNode=function(e){var t=new r.a;return c.nodes.push(t),null!=e&&1!=e||c.updateNodeLinks(),c.recordNodeAction("created",t),t},this.newNodeAt=function(e,t){var o=new r.a;return c.nodes.push(o),o.x(e-100),o.y(t-100),c.updateNodeLinks(),c.recordNodeAction("created",o),o},this.removeNode=function(e){e.selected&&c.deleteSelectedNodes();var t=c.nodes.indexOf(e);t>=0&&(c.recordNodeAction("removed",e),c.nodes.splice(t,1)),c.updateNodeLinks()},this.searchTextInEditor=function(e=!0){e?c.editor.execCommand("find"):c.editor.searchBox&&c.editor.searchBox.hide()},this.showRandomQuote=function(){n.ajax({url:"https://api.forismatic.com/api/1.0/?",dataType:"jsonp",data:"method=getQuote&format=jsonp&lang=en&jsonp=?",success:function(e){alert(e.quoteText+"\n\n-"+e.quoteAuthor)}})},this.editNode=function(e){if(e.active()){c.editing(e),n(".node-editor").css({opacity:0}).transition({opacity:1},250),n(".node-editor .form").css({y:"-100"}).transition({y:"0"},250),c.editor=ace.edit("editor"),c.editor.navigateFileEnd(),document.getElementById("toglAutocomplete").checked=c.config.autocompleteEnabled,document.getElementById("toglAutocompleteWords").checked=c.config.autocompleteWordsEnabled,document.getElementById("toglSpellCheck").checked=c.config.spellcheckEnabled,document.getElementById("toglTranscribing").checked=c.config.transcribeEnabled,c.toglTranscribing(),document.getElementById("toglNightMode").checked=c.config.nightModeEnabled,c.toggleNightMode(),document.getElementById("toglShowCounter").checked=c.config.showCounter,c.toggleShowCounter(),c.toggleWordCompletion(),c.validateTitle(),n("#colorPicker").spectrum({flat:!0,showButtons:!1,showInput:!0,showPalette:!0,preferredFormat:"hex",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"]],change:function(e){n("#colorPicker-container").is(":visible")&&(app.applyPickerColorEditor(e),n("#colorPicker").spectrum("hide"),n("#colorPicker-container").hide(),app.moveEditCursor(e.toHexString().length),app.togglePreviewMode(!1))},clickoutFiresChange:!0});var t=ace.require("ace/ext/language_tools"),o=s.b.createAutocompleter(["string.llink","string.rlink"],c.getOtherNodeTitles(),"Node Link");t.addCompleter(o),c.nodeVisitHistory.includes(e.title())||c.nodeVisitHistory.push(e.title()),this.emPicker=new EmojiPicker(document.getElementById("emojiPickerDom"),e=>{c.insertTextAtCursor(e.char),this.emPicker.toggle(),c.togglePreviewMode(!1)});for(var i=document.getElementById("select_language"),r=0;r<s.b.langs.length;r++){var a=document.createElement("option");a.text=s.b.langs[r][0],i.add(a)}i.selectedIndex=c.selectedLanguageIndex,c.language||(c.language="en-US",c.updateCountry()),c.toggleSpellCheck(),c.updateEditorStats()}},this.chooseRelativePathImage=function(e){c.insertTextAtCursor(e)},this.openNodeByTitle=function(e){c.makeNodeWithName(e),app.nodes().forEach(t=>{t.title().trim().toLowerCase()===e.trim().toLowerCase()&&c.editNode(t)})},this.openLastEditedNode=function(){c.nodeVisitHistory.length<2?c.saveNode():(c.nodeVisitHistory.pop(),c.openNodeByTitle(c.nodeVisitHistory.pop()))},this.getSpellCheckSuggestionItems=function(){var e=Object(i.suggest_word_for_misspelled)(c.editor.getSelectedText());if(e){var t={};return e.forEach(e=>{t[e]={name:e,icon:"edit",callback:e=>{c.insertTextAtCursor(e)}}}),t}return!1},this.getThesaurusItems=function(){var e=o("GLdW")(c.editor.getSelectedText());if(!e)return!1;var t=[];if(Object.keys(e).forEach(function(o){e[o].forEach(function(e){t.includes(e)||e===o||t.push(e)})}),t.length>0){var n={};return t.forEach(e=>{n[e]={name:e,icon:"edit",callback:e=>{c.insertTextAtCursor(e)}}}),n}return!1},this.toggleSpellCheck=function(){var e=document.getElementById("toglSpellCheck");c.config.spellcheckEnabled=e.checked,e.checked?Object(i.enable_spellcheck)():Object(i.disable_spellcheck)()},this.toggleNightMode=function(){var e=document.getElementById("toglNightMode");c.config.nightModeEnabled=e.checked;var t={};t=c.config.nightModeEnabled?{filter:"invert(100%)"}:{filter:"invert(0%)"},n("#app").css(t),n("#app-bg").css(t),n(".tooltip").css(t),n(".node .body").css(t),n(".node-editor .form .editor-container .editor-preview").css(t)},this.toggleShowCounter=function(){var e=document.getElementById("toglShowCounter");c.config.showCounter=e.checked,c.config.showCounter?n(".node-editor .form .bbcode-toolbar .editor-counter").css({display:"initial"}):n(".node-editor .form .bbcode-toolbar .editor-counter").css({display:"none"})},this.toggleWordCompletion=function(){var e=document.getElementById("toglAutocompleteWords");c.config.autocompleteWordsEnabled=e.checked,c.editor.setOptions({enableBasicAutocompletion:c.config.autocompleteWordsEnabled,enableLiveAutocompletion:c.config.autocompleteWordsEnabled})},this.togglePreviewMode=function(e){var t=n(".editor")[0],o=document.getElementById("editor-preview");e?(t.style.visibility="hidden",o.style.visibility="visible",o.innerHTML=c.editing().textToHtml(c.editing().body(),!0),o.scrollTop=c.editor.renderer.scrollTop):(c.editor.session.setScrollTop(o.scrollTop),o.innerHTML="",o.style.visibility="hidden",t.style.visibility="visible",c.editor.focus(),n("#colorPicker-container").is(":visible")&&n("#colorPicker-container").hide(),n("#emojiPicker-container").is(":visible")&&n("#emojiPicker-container").hide())},this.trim=function(e){return e.replace(/^\s+|\s+$/gm,"")},this.appendText=function(e){c.editing().body(c.editing().body()+e);var t=c.editor.session.getLength()-1,o=c.editor.session.getLine(t).length;c.editor.gotoLine(t+1,o)},this.moveEditCursor=function(e){var t=c.editor.getCursorPosition();c.editor.gotoLine(t.row+1,t.column+e),c.editor.focus()},this.insertTextAtCursor=function(e){c.editor.session.replace(c.editor.selection.getRange(),""),c.editor.session.insert(c.editor.getCursorPosition(),e),c.editor.focus()},this.getTagBeforeCursor=function(){var e=c.editor.getSelectionRange(),t=e.start.row,o=e.end.column,n=c.editor.session.getLine(t).substring(0,o);if(n){var i=-1!==n.lastIndexOf("[")?n.substring(n.lastIndexOf("["),n.length):"";return"[["===n.substring(n.length-2,n.length)&&(i="[["),"<<"===n.substring(n.length-2,n.length)&&(i="<<"),i}},n(document).on("keyup",function(e){var t=document.getElementById("toglAutocomplete");if(c.editing()&&t.checked){var o=e.keyCode||e.charCode||e.which;if(37===o||38===o||39===o||40===o)return;if(8===o||46===o||17===o||90===o)return;switch(c.getTagBeforeCursor()){case"[[":c.insertTextAtCursor(" answer: | ]] "),c.moveEditCursor(-4);break;case"<<":c.insertTextAtCursor(" >> "),c.moveEditCursor(-3);break;case"[colo":c.insertTextAtCursor("r=#][/color] "),c.moveEditCursor(-10),c.insertColorCode();break;case"[b":c.insertTextAtCursor("][/b] "),c.moveEditCursor(-5);break;case"[i]":c.insertTextAtCursor("[/i] "),c.moveEditCursor(-5);break;case"[img":c.insertTextAtCursor("][/img] "),c.moveEditCursor(-7);break;case"[u":c.insertTextAtCursor("][/u] "),c.moveEditCursor(-5)}}}),this.testRunFrom=function(e){ipc.send("testYarnStoryFrom",JSON.parse(a.a.getSaveData(s.a.JSON)),e,a.a.editingFileFolder())},this.openNodeListMenu=function(e){var t=document.getElementById(e+"HelperMenuFilter").value,o=document.getElementById(e+"HelperMenu");o.innerHTML="",app.nodes().forEach((n,i)=>{if(n.title().toLowerCase().indexOf(t)>=0||0==t.length){var r=document.createElement("span");r.innerHTML=n.title(),r.setAttribute("class","item");var a=n.titleColorValues[app.nodes()[i].colorID()];r.setAttribute("style","background:"+a+";"),"link"==e?n.title()!==c.editing().title()&&(r.setAttribute("onclick","app.insertTextAtCursor(' [[Answer:"+n.title()+"|"+n.title()+"]]')"),o.appendChild(r)):"open"==e&&(n.title().toLowerCase().indexOf(t)>=0||0==t.length)&&(r.setAttribute("onclick",`app.openNodeByTitle("${n.title()}")`),r.setAttribute("onmouseover",`app.warpToNodeIdx(${c.nodes.indexOf(n)})`),o.appendChild(r))}})},this.saveNode=function(){if(null!=c.editing()){c.makeNewNodesFromLinks(),c.updateNodeLinks(),c.editing().title(c.trim(c.editing().title())),n(".node-editor").transition({opacity:0},250),n(".node-editor .form").transition({y:"-100"},250,function(e){c.editing(null)});var e=document.getElementById("toglAutocomplete");c.config.autocompleteEnabled=e.checked;var t=document.getElementById("toglAutocompleteWords");c.config.autocompleteWordsEnabled=t.checked,setTimeout(c.updateSearch,600)}},this.updateSearch=function(){for(var e=c.$searchField.val().toLowerCase(),t=n(".search-title input").is(":checked"),o=n(".search-body input").is(":checked"),i=n(".search-tags input").is(":checked"),r=0;r<app.nodes().length;r++){var a=app.nodes()[r],s=n(a.element);if(e.length>0&&(t||o||i)){var l=t&&a.title().toLowerCase().indexOf(e)>=0,d=o&&a.body().toLowerCase().indexOf(e)>=0,u=i&&a.tags().toLowerCase().indexOf(e)>=0;l||d||u?(a.active(!0),s.clearQueue(),s.transition({opacity:1},500)):(a.active(!1),s.clearQueue(),s.transition({opacity:.25},500))}else a.active(!0),s.clearQueue(),s.transition({opacity:1},500)}},this.updateNodeLinks=function(){for(var e in c.nodes())c.nodes()[e].updateLinks()},this.makeNewNodesFromLinks=function(){if(this.config&&this.config.overwrites&&!this.config.overwrites.makeNewNodesFromLinks)console.info("Autocreation of new nodes from links is disabled in:\n"+this.configFilePath);else{var e=c.editing().getLinksInNode();if(null!=e)for(var t=0;t<e.length;t++){const n=e[t].trim();var o=220*(t+1);c.makeNodeWithName(n,o)}}},this.makeNodeWithName=function(e,t=220){const o=c.getOtherNodeTitles();e&&e.length>0&&!o.includes(e)&&e!=c.editing().title()&&c.newNodeAt(c.editing().x()+t,c.editing().y()-120).title(e)},this.titleExistsTwice=function(e){return app.nodes().filter(t=>t.title().trim()===e.trim()).length>1},this.getOtherNodeTitles=function(){var e=[];return app.nodes().forEach(t=>{c.editing()&&t.title()===c.editing().title()||e.push(t.title().trim())}),e},this.updateArrows=function(){c.canvas.width=n(window).width(),c.canvas.height=n(window).height();var e=c.cachedScale,t=n(".nodes-holder").offset();c.context.clearRect(0,0,n(window).width(),n(window).height()),c.context.lineWidth=4*e;var o=c.nodes();for(var i in o){var r=o[i];o[i].tempWidth=n(r.element).width(),o[i].tempHeight=n(r.element).height(),o[i].tempOpacity=n(r.element).css("opacity")}for(var a in o){if((r=o[a]).linkedTo().length>0)for(var s in r.linkedTo()){s=s.trim();var l=r.linkedTo()[s],d=(r.x()+r.tempWidth/2)*e+t.left,u=(r.y()+r.tempHeight/2)*e+t.top,p=(l.x()+l.tempWidth/2)*e+t.left,g=(l.y()+l.tempHeight/2)*e+t.top,h=Math.sqrt((d-p)*(d-p)+(u-g)*(u-g)),f={x:(p-d)/h,y:(g-u)/h},m=110+160*(1-Math.max(Math.abs(f.x),Math.abs(f.y))),y={x:d+f.x*m*e,y:u+f.y*m*e},v={x:p-f.x*m*e,y:g-f.y*m*e};c.context.strokeStyle="rgba(0, 0, 0, "+.6*r.tempOpacity+")",c.context.fillStyle="rgba(0, 0, 0, "+.6*r.tempOpacity+")",c.context.beginPath(),c.context.moveTo(y.x,y.y),c.context.lineTo(v.x,v.y),c.context.stroke(),c.context.beginPath(),c.context.moveTo(v.x+4*f.x,v.y+4*f.y),c.context.lineTo(v.x-16*f.x*e-12*f.y*e,v.y-16*f.y*e+12*f.x*e),c.context.lineTo(v.x-16*f.x*e+12*f.y*e,v.y-16*f.y*e-12*f.x*e),c.context.fill()}}},this.updateArrowsThrottled=s.b.throttle(this.updateArrows,this.UPDATE_ARROWS_THROTTLE_MS),this.getHighlightedText=function(e){e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\</g,"&lt;")).replace(/\>/g,"&gt;")).replace(/\&lt;\&lt;(.*?)\&gt;\&gt;/g,'<p class="conditionbounds">&lt;&lt;</p><p class="condition">$1</p><p class="conditionbounds">&gt;&gt;</p>')).replace(/\[\[([^\|]*?)\]\]/g,'<p class="linkbounds">[[</p><p class="linkname">$1</p><p class="linkbounds">]]</p>')).replace(/\[\[([^\[\]]*?)\|([^\[\]]*?)\]\]/g,'<p class="linkbounds">[[</p>$1<p style="color:red"><p class="linkbounds">|</p><p class="linkname">$2</p><p class="linkbounds">]]</p>')).replace(/[^:]\/\/(.*)?($|\n)/g,'<span class="comment">//$1</span>\n')).replace(/\/\*((.|[\r\n])*)?\*\//gm,'<span class="comment">/*$1*/</span>')).replace(/\/\%((.|[\r\n])*)?\%\//gm,'<span class="comment">/%$1%/</span>');var t=n("<div>");return t[0].innerHTML=e,t.find(".comment").each(function(){n(this).find("p").each(function(){n(this).removeClass()})}),t.find(".linkname").each(function(){var e=n(this).text(),t=!1;for(var o in c.nodes())if(c.nodes()[o].title().toLowerCase()==e.toLowerCase()){t=!0;break}t||n(this).removeClass("linkname")}),e=t[0].innerHTML},this.updateLineNumbers=function(e){for(var t=e.split("\n"),o="",i=0;i<Math.max(1,t.length);i++)(0==i||i<t.length-1||t[i].length>0)&&(o+=i+1+"<br />");n(".editor-container .lines").html(o)},this.updateHighlights=function(e){if(!(17==e.keyCode||e.keyCode>=37&&e.keyCode<=40)){var t,o,i=n(".editor"),r=i[0].innerText;if((e.metaKey||e.ctrlKey)&&90==e.keyCode){if(!(c.editingHistory.length>0))return;var a=c.editingHistory.pop();r=a.text,t=a.start,o=a.end}else{var s=(u=window.getSelection().getRangeAt(0)).cloneRange();s.selectNodeContents(i[0]),s.setEnd(u.startContainer,u.startOffset),t=s.toString().length;var l=u.cloneRange();if(l.selectNodeContents(i[0]),l.setEnd(u.endContainer,u.endOffset),o=l.toString().length,(e.metaKey||e.ctrlKey)&&67==e.keyCode){if(null!=c.gui)(d=c.gui.Clipboard.get()).set(r.substr(t,o-t),"text")}else{if((e.metaKey||e.ctrlKey)&&86==e.keyCode){var d=c.gui.Clipboard.get();r=r.substr(0,t)+d.get("text")+r.substr(o),t=o=t+d.get("text").length}else if((e.metaKey||e.ctrlKey)&&88==e.keyCode){if(null!=c.gui)(d=c.gui.Clipboard.get()).set(r.substr(t,o-t),"text"),r=r.substr(0,t)+r.substr(o),o=t}else 13==e.keyCode?(o++,++t>r.length&&(t=r.length),o>r.length&&(o=r.length)):9==e.keyCode&&(r=r.substr(0,t)+"\t"+r.substr(o),o=++t,e.preventDefault());0!=c.editingHistory.length&&r==c.editingHistory[c.editingHistory.length-1].text||(null==c.editingSaveHistoryTimeout&&c.editingHistory.push({text:r,start:t,end:o}),clearTimeout(c.editingSaveHistoryTimeout),c.editingSaveHistoryTimeout=setTimeout(function(){c.editingSaveHistoryTimeout=null},500))}}if(c.updateLineNumbers(r),document.createRange&&window.getSelection){var u;(u=document.createRange()).selectNodeContents(i[0]);for(var p,g,h=function e(t){var o=[];if(3==t.nodeType)o.push(t);else for(var n=t.childNodes,i=0,r=n.length;i<r;++i)o.push.apply(o,e(n[i]));return o}(i[0]),f=0,m=!1,y=!1,v=0;(g=h[v++])&&(p=f+g.length,!m&&t>=f&&(t<=p||t==p&&v<h.length)&&(u.setStart(g,t-f),m=!0),!y&&o>=f&&(o<=p||o==p&&v<h.length)&&(u.setEnd(g,o-f),y=!0),!m||!y);)f=p;var b=window.getSelection();b.removeAllRanges(),b.addRange(u)}}},this.zoom=function(e){c.cachedScale=e/4,c.translate(200)},this.translate=function(e){var t=setInterval(c.updateArrowsThrottled,16);n(".nodes-holder").transition({transform:"matrix("+c.cachedScale+",0,0,"+c.cachedScale+","+c.transformOrigin[0]+","+c.transformOrigin[1]+")"},e||0,"easeInQuad",function(){clearInterval(t),c.updateArrowsThrottled()})},this.arrangeX=function(){var e=c.nodes().filter(function(e){return e.selected}).sort(function(e,t){return e.x()>t.x()?1:e.x()<t.x()?-1:0}),t=e.shift();e.length?e.forEach(function(e,o){var n=t.x()+210*(o+1);e.moveTo(n,t.y())}):alert("Select nodes to align")},this.arrangeY=function(){var e=c.nodes().filter(function(e){return e.selected}).sort(function(e,t){return e.y()>t.y()?1:e.y()<t.y()?-1:0}),t=e.shift();e.length?e.forEach(function(e,o){var n=t.y()+210*(o+1);e.moveTo(t.x(),n)}):alert("Select nodes to align")},this.arrangeSpiral=function(){const e=c.getSelectedNodes().length?c.getSelectedNodes():c.nodes();for(var t in e){var o=e[t],n=Math.sin(.5*t)*(600+30*t),i=Math.cos(.5*t)*(600+30*t);o.moveTo(i,n)}},this.sortAlphabetical=function(){const e=c.getSelectedNodes().length?c.getSelectedNodes():c.nodes();e.sort(function(e,t){return e.title().localeCompare(t.title())});var t=Math.round(e.length/2),o=0,n=0;e.forEach(function(i,r){r%t==0?(n+=1,o=0):o+=1,1===r&&(n=0),i.moveTo(e[0].x()+210*o,e[0].y()+210*n)}),c.warpToNodeIdx(c.nodes.indexOf(e[0]))},this.moveNodes=function(e,t){for(var o in c.nodes()){var n=c.nodes()[o];n.moveTo(n.x()+e,n.y()+t)}},this.warpToNodeIdx=function(e){if(c.nodes().length>e){var t=c.nodes()[e],o=-t.x()*c.cachedScale,i=-t.y()*c.cachedScale,r=n(window).width()/2,a=n(window).height()/2,s=t.tempWidth*c.cachedScale/2,l=t.tempHeight*c.cachedScale/2;c.transformOrigin[0]=o+r-s,c.transformOrigin[1]=i+a-l,c.translate(100),c.focusedNodeIdx=e}},this.warpToSelectedNodeIdx=function(e){if(c.getSelectedNodes().length>e){var t=c.getSelectedNodes()[e],o=-t.x()*c.cachedScale,i=-t.y()*c.cachedScale,r=n(window).width()/2,a=n(window).height()/2,s=t.tempWidth*c.cachedScale/2,l=t.tempHeight*c.cachedScale/2;c.transformOrigin[0]=o+r-s,c.transformOrigin[1]=i+a-l,c.translate(100),c.focusedNodeIdx=e}},this.getFirstFoundNode=function(e){return c.nodes().find(t=>t.title().toLowerCase().includes(e))},this.warpToNodeXY=function(e,t){var o=-e*c.cachedScale,i=-t*c.cachedScale,r=n(window).width()/2,a=n(window).height()/2,s=100*c.cachedScale/2,l=100*c.cachedScale/2;c.transformOrigin[0]=o+r-s,c.transformOrigin[1]=i+a-l,c.translate(100)},this.searchWarp=function(){var e=c.$searchField.val().toLowerCase().trim();if(""===e)c.warpToNodeIdx(0);else{const t=c.getFirstFoundNode(e);c.warpToNodeIdx(c.nodes.indexOf(t))}},this.clearSearch=function(){c.$searchField.val(""),c.updateSearch()},this.updateEditorStats=function(){var e=c.editor.getSession().getValue(),t=c.editor.getCursorPosition(),o=e.split("\n");n(".editor-counter .character-count").html(e.length),n(".editor-counter .line-count").html(o.length),n(".editor-counter .row-index").html(t.row),n(".editor-counter .column-index").html(t.column)}}}).call(this,o("Z1dp"),o("EVdn"))},W2Rx:function(e,t,o){"use strict";(function(e,n){o.d(t,"a",function(){return l});var i=o("2Qx2"),r=o("oj90"),a=0;const s=o("L8pc");var l=function(){var t=this;this.titleColorValues=["#eee","#6EA5E0","#9EDE74","#FFE374","#F7A666","#C47862","#97E1E9"],this.index=e.observable(a++),this.title=e.observable("Node"+this.index()),this.tags=e.observable(""),this.body=e.observable("Empty Text"),this.active=e.observable(!0),this.tempWidth,this.tempHeight,this.tempOpacity,this.style,this.colorID=e.observable(0),this.checked=!1,this.selected=!1,this.createX=null,this.createY=null,this.clippedTags=e.computed(function(){var e=this.tags().split(" "),t="";if(this.tags().length>0)for(var o=0;o<e.length;o++)t+="<span>"+e[o]+"</span>";return t},this),this.textToHtml=function(e,t=!1){var o=1,n=t?'<font color="pink">'+o+".   </font>"+e:e;return n=(n=(n=(n=(n=(n=n.replace(/\[\[[^\[]+\]\]/gi,function(e){const t=e.match(/\[\[(.*)\]\]/i);if(t.length>1)return'<font color="tomato">(go:'+t[1]+")</font>"})).replace(/<</gi,"<font color='violet'>(run:")).replace(/>>/gi,")</font>")).replace(/\[color=#[A-Za-z0-9]+\]/gi,function(e){const t=e.match(/\[color=#([A-Za-z0-9]+)\]/i);if(t&&t.length>1)return"[color=#"+t[1]+"]<font color=#"+t[1]+">&#9751</font>"})).replace(/\[img\][^\[]+\[\/img\]/gi,function(e){const o=e.match(/\[img\](.*)\[\/img\]/i);if(o.length>1){const e=i.a.editingFileFolder(o[1]);return i.a.doesFileExist(e)?t?'<img src="'+e+'"> </img>':'<img src="'+e+'" width="128" height="auto"> </img>':t?'<img src="'+o[1]+'"> </img>':'<img src="'+o[1]+'" width="128" height="auto"> </img>'}})).replace(/[\n\r]/g,function(e){var n="<br/>";return o+=1,t&&(n+='<font color="pink">'+o+".   </font>"),n}),n=s.parse(n)},this.clippedBody=e.computed(function(){if(!app.editing()){var e=app.getHighlightedText(this.body());return e=(e=t.textToHtml(e)).substr(0,1024)}},this),this.linkedTo=e.observableArray(),this.linkedFrom=e.observableArray(),this.element=null,this.canDoubleClick=!0,this.create=function(){if(r.b.pushToTop(n(t.element)),t.style=window.getComputedStyle(n(t.element).get(0)),t.createX&&t.createY)t.x(t.createX),t.y(t.createY);else{var e=n(t.element).parent();t.x(-e.offset().left+n(window).width()/2-100),t.y(-e.offset().top+n(window).height()/2-100)}var o=setInterval(app.updateArrowsThrottled,16);n(t.element).css({opacity:0,scale:.8,y:"-=80px",rotate:"45deg"}).transition({opacity:1,scale:1,y:"+=80px",rotate:"0deg"},250,"easeInQuad",function(){clearInterval(o),app.updateArrowsThrottled()}),t.drag(),n(t.element).on("dblclick",function(){t.canDoubleClick&&app.editNode(t)}),r.b.addDoubleTapDetector(t.element,function(){t.canDoubleClick&&app.editNode(t)}),n(t.element).on("click",function(e){e.ctrlKey&&(t.selected?app.removeNodeSelection(t):app.addNodeSelected(t))})},this.setSelected=function(e){t.selected=e,t.selected?n(t.element).css({border:"1px solid #49eff1"}):n(t.element).css({border:"none"})},this.toggleSelected=function(){t.setSelected(!t.selected)},this.x=function(e){return null!=e&&n(t.element).css({x:Math.floor(e)}),Math.floor(new WebKitCSSMatrix(t.style.webkitTransform).m41)},this.y=function(e){return null!=e&&n(t.element).css({y:Math.floor(e)}),Math.floor(new WebKitCSSMatrix(t.style.webkitTransform).m42)},this.resetDoubleClick=function(){t.canDoubleClick=!0},this.tryRemove=function(){t.active()&&app.deleting(this),setTimeout(t.resetDoubleClick,500),t.canDoubleClick=!1},this.cycleColorDown=function(){t.doCycleColorDown(),setTimeout(t.resetDoubleClick,500),t.canDoubleClick=!1,app.shifted&&app.matchConnectedColorID(t),t.selected&&app.setSelectedColors(t)},this.cycleColorUp=function(){t.doCycleColorUp(),setTimeout(t.resetDoubleClick,500),t.canDoubleClick=!1,app.shifted&&app.matchConnectedColorID(t),t.selected&&app.setSelectedColors(t)},this.doCycleColorDown=function(){t.colorID(t.colorID()-1),t.colorID()<0&&t.colorID(6)},this.doCycleColorUp=function(){t.colorID(t.colorID()+1),t.colorID()>6&&t.colorID(0)},this.remove=function(){n(t.element).transition({opacity:0,scale:.8,y:"-=80px",rotate:"-45deg"},250,"easeInQuad",function(){app.removeNode(t),app.updateArrowsThrottled()}),app.deleting(null)},this.drag=function(){var e=!1,o=!1,i=[0,0],r=!1;n(document.body).on("mousemove touchmove",function(a){if(e){n(t.element).parent();const e=app.hasTouchScreen&&a.changedTouches?a.changedTouches[0].pageX:a.pageX,g=app.hasTouchScreen&&a.changedTouches?a.changedTouches[0].pageY:a.pageY;var s=e/t.getScale()-i[0],l=g/t.getScale()-i[1],c=s-t.x(),d=l-t.y();if(r=!0,t.x(s),t.y(l),o){var u=[];if(t.selected?(u=app.getSelectedNodes()).splice(u.indexOf(t),1):u=app.getNodesConnectedTo(t),u.length>0)for(var p in u)u[p].x(u[p].x()+c),u[p].y(u[p].y()+d)}app.updateArrowsThrottled()}}),n(t.element).on("pointerdown",function(r){if(!e&&t.active()){n(t.element).parent();e=!0,(app.shifted||t.selected)&&(o=!0),i[0]=r.pageX/t.getScale()-t.x(),i[1]=r.pageY/t.getScale()-t.y()}}),n(t.element).on("pointerdown",function(e){e.stopPropagation()}),n(t.element).on("pointerup",function(e){r||app.mouseUpOnNodeNotMoved(),r=!1}),n(document.body).on("pointerup",function(t){e=!1,o=!1,r=!1,app.updateArrowsThrottled()})},this.moveTo=function(e,o){n(t.element).clearQueue(),n(t.element).transition({x:e,y:o},app.updateArrowsThrottled,500)},this.isConnectedTo=function(e,o){if(o&&e.isConnectedTo(t,!1))return!0;var n=t.linkedTo();for(var i in n){if(n[i]==e)return!0;if(n[i].isConnectedTo(e,!1))return!0;if(e.isConnectedTo(n[i],!1))return!0}return!1},this.getLinksInNode=function(){var e=t.body().match(/\[\[(.*?)\]\]/g);if(null!=e){for(var o={},n=e.length-1;n>=0;n--)e[n]=e[n].substr(2,e[n].length-4).trim(),e[n].indexOf("|")>=0&&(e[n]=e[n].split("|")[1]),null!=o[e[n]]&&e.splice(n,1),o[e[n]]=!0;return e}},this.updateLinks=function(){t.resetDoubleClick(),t.linkedTo.removeAll();var e=t.getLinksInNode();if(null!=e)for(var o in app.nodes())for(var n=app.nodes()[o],i=0;i<e.length;i++)n!=t&&n.title().trim()==e[i].trim()&&t.linkedTo.push(n)},this.getScale=function(){return app&&"number"==typeof app.cachedScale?app.cachedScale:1}};e.bindingHandlers.nodeBind={init:function(e,t,o,n,i){i.$rawData.element=e,i.$rawData.create()},update:function(e,t,o,i,a){n(e).on("pointerdown",function(){r.b.pushToTop(n(e))})}}}).call(this,o("Z1dp"),o("EVdn"))},e6Wu:function(e,t,o){"use strict";o.r(t);o("hZTp");var n=o("0h2I"),i=o.n(n),r=(o("5uVa"),o("si6p"),o("bU/s")),a=o.n(r),s=(o("A8C4"),o("VEX6"),o("jF1P"),o("YhK8"),o("Ab/9"),o("KDOe"),o("XfCI"),o("P0sH"));window.ko=i.a,window.$=window.jQuery=o("EVdn"),window.ace=a.a,a.a.config.set("basePath","public"),window.define=a.a.define,window.app=new s.a("Yarn","0.4.1"),window.app.run()},hZTp:function(e,t,o){},jF1P:function(e,t,o){(function(e){var t,o;t={},o=0,e.bindingHandlers.ace={init:function(n,i,r,a,s){var l=r().aceOptions||{},c=e.utils.unwrapObservable(i());n.id||(n.id="knockout-ace-"+o,o+=1);var d=ace.edit(n.id);l.theme&&d.setTheme("ace/theme/"+l.theme),l.mode&&d.getSession().setMode("ace/mode/"+l.mode),d.setValue(c),d.gotoLine(0),d.setShowPrintMargin(!1),d.getSession().setUseWrapMode(!0),d.getSession().on("change",function(t){e.isWriteableObservable(i())&&i()(d.getValue())}),t[n.id]=d,e.utils.domNodeDisposal.addDisposeCallback(n,function(){try{d.destroy()}catch(e){}delete t[n.id]})},update:function(o,n,i,r,a){var s=e.utils.unwrapObservable(n()),l=o.id;if(void 0!==l&&""!==l&&t.hasOwnProperty(l)){var c=t[l];c.getValue()!==s&&(c.setValue(s),c.gotoLine(0))}}},e.aceEditors={resizeAll:function(){for(var e in t)t.hasOwnProperty(e)&&t[e].resize()},get:function(e){return t[e]}}}).call(this,o("Z1dp"))},oj90:function(e,t,o){"use strict";(function(e){o.d(t,"a",function(){return n}),o.d(t,"b",function(){return i});var n={JSON:"json",XML:"xml",TWEE:"twee",TWEE2:"tw2",UNKNOWN:"none",YARNTEXT:"yarn.txt"},i={createAutocompleter:function(e,t,o,n=1){return{getCompletions:function(i,r,a,s,l){var c=i.session.getTokenAt(a.row,a.column);s.length<n||!e.includes(c.type)?l(null,[]):l(null,t.map(function(e){return{caption:e,value:e,meta:o}}))}}},addDoubleTapDetector:function(e,t){e.lastTap=0,e.tapTimeout=0,e.addEventListener("touchend",function(o){var n=(new Date).getTime(),i=n-e.lastTap;clearTimeout(e.tapTimeout),i<500&&i>0?(t(),o.preventDefault()):e.tapTimeout=setTimeout(function(){clearTimeout(e.tapTimeout)},500),e.lastTap=n})},pushToTop:function(t){var o=t.css("z-index");"auto"==o&&(o=0);var n=parseInt(o),i=!0;t.parent().children().each(function(){var o=e(this).css("z-index");"auto"==o&&(o=0);var r=parseInt(o);this!=t[0]&&r>=n&&(n=r,i=!1)}),i||t.css("z-index",n+1)},stripHtml:function(e){for(;e.indexOf("<")>=0;)e=e.replace("<","&lt;");for(;e.indexOf(">")>=0;)e=e.replace(">","&gt");return e},xmlToObject:function(e){var t=[];if((e=e.childNodes.item(0)).hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var n=e.childNodes.item(o);if(n.hasChildNodes()){for(var i={},r=!1,a=0;a<n.childNodes.length;a++){var s=n.childNodes.item(a);if("#text"!=s.nodeName&&(r=!0,s.hasChildNodes()?i[s.nodeName]=s.childNodes.item(0).nodeValue:i[s.nodeName]="",s.attributes.length>0)){i[s.nodeName]={};for(var l=0;l<s.attributes.length;l++){var c=s.attributes.item(l);i[s.nodeName][c.nodeName]=c.nodeValue}}}r&&t.push(i)}}return console.log(t),t},now:Date.now||function(){return(new Date).getTime()},throttle:function(e,t,o){var n,i,r,a=this,s=null,l=0;o||(o={});var c=function(){l=!1===o.leading?0:a.now(),s=null,r=e.apply(n,i),s||(n=i=null)};return function(){var d=a.now();l||!1!==o.leading||(l=d);var u=t-(d-l);return n=this,i=arguments,u<=0||u>t?(s&&(clearTimeout(s),s=null),l=d,r=e.apply(n,i),s||(n=i=null)):s||!1===o.trailing||(s=setTimeout(c,u)),r}},langs:[["Afrikaans",["af-ZA"]],["Bahasa Indonesia",["id-ID"]],["Bahasa Melayu",["ms-MY"]],["Català",["ca-ES"]],["Čeština",["cs-CZ"]],["Deutsch",["de-DE"]],["English",["en-AU","Australia"],["en-CA","Canada"],["en-IN","India"],["en-NZ","New Zealand"],["en-ZA","South Africa"],["en-GB","United Kingdom"],["en-US","United States"]],["Español",["es-AR","Argentina"],["es-BO","Bolivia"],["es-CL","Chile"],["es-CO","Colombia"],["es-CR","Costa Rica"],["es-EC","Ecuador"],["es-SV","El Salvador"],["es-ES","España"],["es-US","Estados Unidos"],["es-GT","Guatemala"],["es-HN","Honduras"],["es-MX","México"],["es-NI","Nicaragua"],["es-PA","Panamá"],["es-PY","Paraguay"],["es-PE","Perú"],["es-PR","Puerto Rico"],["es-DO","República Dominicana"],["es-UY","Uruguay"],["es-VE","Venezuela"]],["Euskara",["eu-ES"]],["Français",["fr-FR"]],["Galego",["gl-ES"]],["Hrvatski",["hr_HR"]],["IsiZulu",["zu-ZA"]],["Íslenska",["is-IS"]],["Italiano",["it-IT","Italia"],["it-CH","Svizzera"]],["Magyar",["hu-HU"]],["Nederlands",["nl-NL"]],["Norsk bokmål",["nb-NO"]],["Polski",["pl-PL"]],["Português",["pt-BR","Brasil"],["pt-PT","Portugal"]],["Română",["ro-RO"]],["Slovenčina",["sk-SK"]],["Suomi",["fi-FI"]],["Svenska",["sv-SE"]],["Türkçe",["tr-TR"]],["български",["bg-BG"]],["Pусский",["ru-RU"]],["Српски",["sr-RS"]],["한국어",["ko-KR"]],["中文",["cmn-Hans-CN","普通话 (中国大陆)"],["cmn-Hans-HK","普通话 (香港)"],["cmn-Hant-TW","中文 (台灣)"],["yue-Hant-HK","粵語 (香港)"]],["日本語",["ja-JP"]],["Lingua latīna",["la"]]],createDropboxChooser:function(e,t){var o={success:function(e){e.forEach(function(e){t(e)})},cancel:function(){},linkType:"direct",multiselect:!1},n=Dropbox.createChooseButton(o);e.appendChild(n)},makeTextFile:function(e,t){var o=new Blob([e],{type:"text/plain"});return null!==t&&window.URL.revokeObjectURL(textFile),t=window.URL.createObjectURL(o)}}}).call(this,o("EVdn"))},owJe:function(e,t,o){(function(e){var n=o("jXEy"),i="editor",r="public/dictionaries/en/index.dic",a="public/dictionaries/en/index.aff";e("<style type='text/css'>.ace_marker-layer .misspelled { position: absolute; z-index: -2; border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head"),e("<style type='text/css'>.misspelled { border-bottom: 1px solid red; margin-bottom: -1px; }</style>").appendTo("head");var s=null;function l(e){var t=e.split(/\s+|\.|\,|\?|\\|\/|\!|\[|\]|"|'|;|:|`|\+|\-|\&|\$|@|~|#|>|<|_|\)|\(|£|\^|%|\*|„|“|\||[0-9]+/g),o=0,n=[];for(word in t){var i=t[word];s.correct(i)||(n[n.length]=[o,o+t[word].length]),o+=t[word].length+1}return n}t.load_dictionary=function(t){console.info(`Loading ${t} hunspell dictionary locally`),r=`public/dictionaries/${t}/index.dic`,a=`public/dictionaries/${t}/index.aff`,e.get(r,function(e){dicData=e}).fail(function(){console.error(`${t} not found locally. Loading dictionary from server instead...`),r=`https://raw.githubusercontent.com/wooorm/dictionaries/master/dictionaries/${t}/index.dic`,a=`https://raw.githubusercontent.com/wooorm/dictionaries/master/dictionaries/${t}/index.aff`,e.get(r,function(e){dicData=e}).done(function(){e.get(a,function(e){affData=e}).done(function(){console.log("Dictionary loaded from server"),s=new n(affData,dicData),c=!0,p()})})}).done(function(){e.get(a,function(e){affData=e}).done(function(){console.log("Dictionary loaded locally"),s=new n(affData,dicData),c=!0,p()})})},t.misspelled=l;var c=!0,d=!1,u=[];function p(){if(null!=s&&!d&&c){d=!0;var e=ace.edit(i).getSession();h();try{var t=ace.require("ace/range").Range,o=e.getDocument().getAllLines();for(var n in o){var r=l(o[n]);for(var a in r){var p=new t(n,r[a][0],n,r[a][1]);u[u.length]=e.addMarker(p,"misspelled","typo",!0)}}}finally{d=!1,c=!1}}}t.spell_check=p;var g=!1;function h(){var e=ace.edit(i).getSession();for(var t in u)e.removeMarker(u[t]);u=[];var o=e.getDocument().getAllLines();for(var t in o)e.removeGutterDecoration(t,"misspelled")}t.enable_spellcheck=function(){g=!0,ace.edit(i).getSession().on("change",function(e){g&&(c=!0,p())}),c=!0,p()},t.disable_spellcheck=function(){g=!1,h()},t.clear_spellcheck_markers=h,t.suggest_word_for_misspelled=function(e){var t=s.suggest(e);return 0!==t.length&&t}}).call(this,o("EVdn"))}},[["e6Wu",1,2]]]);